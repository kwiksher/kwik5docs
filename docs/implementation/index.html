<!doctype html><html><head><title>Kwik</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta name=revised content="2023-05-11T01:16:58 UTC"><title>Implementation :: Kwik</title><link rel="shortcut icon" href=/kwik5docs/images/favicon.png type=image/x-icon><link href=/kwik5docs/css/nucleus.css rel=stylesheet><link href=/kwik5docs/css/font-awesome.min.css rel=stylesheet><link href=/kwik5docs/css/featherlight.min.css rel=stylesheet><link href=/kwik5docs/css/auto-complete.css rel=stylesheet><link href=/kwik5docs/theme-flex/style.css rel=stylesheet><link rel=stylesheet href=/kwik5docs/css/bootstrap.min.css><meta name=description content></head><body data-url=/kwik5docs/implementation/><header><div class=logo><a class=baselink href=https://kwiksher.github.io/kwik5docs/>Kwik</a></div><div class=burger><a href=javascript:void(0); style=font-size:15px>&#9776;</a></div><nav class=shortcuts><li role><a href=https://github.com/kwiksher/ rel=noopener><i class='fa fa-github'></i> <label>Github repo</label></a></li><li role><a href=https://github.com/vjeantet/hugo-theme-docdock/archive/master.zip rel=noopener><i class='fa fa-cloud-download'></i> <label>Download</label></a></li><li role><a href=https://gohugo.io/ rel=noopener><i class='fa fa-bookmark'></i> <label>Hugo Documentation</label></a></li><li role><a href=/kwik5docs/credits rel=noopener><i class='fa fa-bullhorn'></i> <label>Credits</label></a></li></nav></header><article><aside><ul class=menu><li data-nav-id=https://kwiksher.github.io/kwik5docs/introduction/ class=dd-item><div><a href=/kwik5docs/introduction/>Introduction</a><i class="fa fa-circle-thin read-icon"></i></div></li><li data-nav-id=https://kwiksher.github.io/kwik5docs/get_started/ class="dd-item haschildren"><div><a href=/kwik5docs/get_started/>Get Started</a><i class="fa fa-angle-right fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i></div><ul><li data-nav-id=https://kwiksher.github.io/kwik5docs/get_started/step1/ class=dd-item><div><a href=/kwik5docs/get_started/step1/>Step 1 - UXP
</a><i class="fa fa-circle-thin read-icon"></i></div></li><li data-nav-id=https://kwiksher.github.io/kwik5docs/get_started/step2/ class=dd-item><div><a href=/kwik5docs/get_started/step2/>Step2 - Solar2D
</a><i class="fa fa-circle-thin read-icon"></i></div></li><li data-nav-id=https://kwiksher.github.io/kwik5docs/get_started/naming_rule/ class=dd-item><div><a href=/kwik5docs/get_started/naming_rule/>PSD Naming Rule
</a><i class="fa fa-circle-thin read-icon"></i></div></li><li data-nav-id=https://kwiksher.github.io/kwik5docs/get_started/components/ class=dd-item><div><a href=/kwik5docs/get_started/components/>Components
</a><i class="fa fa-circle-thin read-icon"></i></div></li><li data-nav-id=https://kwiksher.github.io/kwik5docs/get_started/events/ class=dd-item><div><a href=/kwik5docs/get_started/events/>Commands & Events
</a><i class="fa fa-circle-thin read-icon"></i></div></li><li data-nav-id=https://kwiksher.github.io/kwik5docs/get_started/tools/ class=dd-item><div><a href=/kwik5docs/get_started/tools/>Tools
</a><i class="fa fa-circle-thin read-icon"></i></div></li><li data-nav-id=https://kwiksher.github.io/kwik5docs/get_started/unittest/ class=dd-item><div><a href=/kwik5docs/get_started/unittest/>Unit Test
</a><i class="fa fa-circle-thin read-icon"></i></div></li><li data-nav-id=https://kwiksher.github.io/kwik5docs/get_started/vscode/ class=dd-item><div><a href=/kwik5docs/get_started/vscode/>Visual Studio Code
</a><i class="fa fa-circle-thin read-icon"></i></div></li></ul></li><li data-nav-id=https://kwiksher.github.io/kwik5docs/design/ class="dd-item haschildren"><div><a href=/kwik5docs/design/>Design</a><i class="fa fa-angle-right fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i></div><ul><li data-nav-id=https://kwiksher.github.io/kwik5docs/design/architecture/ class=dd-item><div><a href=/kwik5docs/design/architecture/>Architecure
</a><i class="fa fa-circle-thin read-icon"></i></div></li><li data-nav-id=https://kwiksher.github.io/kwik5docs/design/project_model/ class="dd-item haschildren"><div><a href=/kwik5docs/design/project_model/>Project Model</a><i class="fa fa-angle-right fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i></div><ul><li data-nav-id=https://kwiksher.github.io/kwik5docs/design/project_model/photoshop/ class=dd-item><div><a href=/kwik5docs/design/project_model/photoshop/>Photoshop File
</a><i class="fa fa-circle-thin read-icon"></i></div></li><li data-nav-id=https://kwiksher.github.io/kwik5docs/design/project_model/icons/ class=dd-item><div><a href=/kwik5docs/design/project_model/icons/>Icons Launch/Splash screens
</a><i class="fa fa-circle-thin read-icon"></i></div></li><li data-nav-id=https://kwiksher.github.io/kwik5docs/design/project_model/content/ class=dd-item><div><a href=/kwik5docs/design/project_model/content/>Content X Structure
</a><i class="fa fa-circle-thin read-icon"></i></div></li><li data-nav-id=https://kwiksher.github.io/kwik5docs/design/project_model/commands/ class="dd-item haschildren"><div><a href=/kwik5docs/design/project_model/commands/>Commands</a><i class="fa fa-angle-right fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i></div><ul><li data-nav-id=https://kwiksher.github.io/kwik5docs/design/project_model/commands/editor/ class=dd-item><div><a href=/kwik5docs/design/project_model/commands/editor/>action editor
</a><i class="fa fa-circle-thin read-icon"></i></div></li><li data-nav-id=https://kwiksher.github.io/kwik5docs/design/project_model/commands/ui/ class=dd-item><div><a href=/kwik5docs/design/project_model/commands/ui/>UI
</a><i class="fa fa-circle-thin read-icon"></i></div></li><li data-nav-id=https://kwiksher.github.io/kwik5docs/design/project_model/commands/canvas/ class=dd-item><div><a href=/kwik5docs/design/project_model/commands/canvas/>canvas
</a><i class="fa fa-circle-thin read-icon"></i></div></li><li data-nav-id=https://kwiksher.github.io/kwik5docs/design/project_model/commands/screenshot/ class=dd-item><div><a href=/kwik5docs/design/project_model/commands/screenshot/>screenshot
</a><i class="fa fa-circle-thin read-icon"></i></div></li></ul></li><li data-nav-id=https://kwiksher.github.io/kwik5docs/design/project_model/components/ class="dd-item haschildren"><div><a href=/kwik5docs/design/project_model/components/>Components</a><i class="fa fa-angle-right fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i></div><ul><li data-nav-id=https://kwiksher.github.io/kwik5docs/design/project_model/components/image/ class=dd-item><div><a href=/kwik5docs/design/project_model/components/image/>Layer
</a><i class="fa fa-circle-thin read-icon"></i></div></li><li data-nav-id=https://kwiksher.github.io/kwik5docs/design/project_model/components/animation/ class=dd-item><div><a href=/kwik5docs/design/project_model/components/animation/>Animation
</a><i class="fa fa-circle-thin read-icon"></i></div></li><li data-nav-id=https://kwiksher.github.io/kwik5docs/design/project_model/components/audio/ class=dd-item><div><a href=/kwik5docs/design/project_model/components/audio/>Audio
</a><i class="fa fa-circle-thin read-icon"></i></div></li><li data-nav-id=https://kwiksher.github.io/kwik5docs/design/project_model/components/button/ class=dd-item><div><a href=/kwik5docs/design/project_model/components/button/>Button
</a><i class="fa fa-circle-thin read-icon"></i></div></li><li data-nav-id=https://kwiksher.github.io/kwik5docs/design/project_model/components/canvas/ class=dd-item><div><a href=/kwik5docs/design/project_model/components/canvas/>Canvas
</a><i class="fa fa-circle-thin read-icon"></i></div></li><li data-nav-id=https://kwiksher.github.io/kwik5docs/design/project_model/components/group/ class=dd-item><div><a href=/kwik5docs/design/project_model/components/group/>Group
</a><i class="fa fa-circle-thin read-icon"></i></div></li><li data-nav-id=https://kwiksher.github.io/kwik5docs/design/project_model/components/particles/ class=dd-item><div><a href=/kwik5docs/design/project_model/components/particles/>Particles
</a><i class="fa fa-circle-thin read-icon"></i></div></li><li data-nav-id=https://kwiksher.github.io/kwik5docs/design/project_model/components/spritesheet/ class=dd-item><div><a href=/kwik5docs/design/project_model/components/spritesheet/>Spritesheet
</a><i class="fa fa-circle-thin read-icon"></i></div></li><li data-nav-id=https://kwiksher.github.io/kwik5docs/design/project_model/components/sync_audio_text/ class=dd-item><div><a href=/kwik5docs/design/project_model/components/sync_audio_text/>Sync Audio&Text
</a><i class="fa fa-circle-thin read-icon"></i></div></li><li data-nav-id=https://kwiksher.github.io/kwik5docs/design/project_model/components/timer/ class=dd-item><div><a href=/kwik5docs/design/project_model/components/timer/>Timer
</a><i class="fa fa-circle-thin read-icon"></i></div></li></ul></li><li data-nav-id=https://kwiksher.github.io/kwik5docs/design/project_model/settings/ class="dd-item haschildren"><div><a href=/kwik5docs/design/project_model/settings/>Settings</a><i class="fa fa-angle-right fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i></div><ul><li data-nav-id=https://kwiksher.github.io/kwik5docs/design/project_model/settings/ios/ class=dd-item><div><a href=/kwik5docs/design/project_model/settings/ios/>iOS
</a><i class="fa fa-circle-thin read-icon"></i></div></li><li data-nav-id=https://kwiksher.github.io/kwik5docs/design/project_model/settings/android/ class=dd-item><div><a href=/kwik5docs/design/project_model/settings/android/>android
</a><i class="fa fa-circle-thin read-icon"></i></div></li><li data-nav-id=https://kwiksher.github.io/kwik5docs/design/project_model/settings/macos/ class=dd-item><div><a href=/kwik5docs/design/project_model/settings/macos/>macOS
</a><i class="fa fa-circle-thin read-icon"></i></div></li><li data-nav-id=https://kwiksher.github.io/kwik5docs/design/project_model/settings/tvos/ class=dd-item><div><a href=/kwik5docs/design/project_model/settings/tvos/>tvOS
</a><i class="fa fa-circle-thin read-icon"></i></div></li><li data-nav-id=https://kwiksher.github.io/kwik5docs/design/project_model/settings/win32/ class=dd-item><div><a href=/kwik5docs/design/project_model/settings/win32/>Win32
</a><i class="fa fa-circle-thin read-icon"></i></div></li><li data-nav-id=https://kwiksher.github.io/kwik5docs/design/project_model/settings/html5/ class=dd-item><div><a href=/kwik5docs/design/project_model/settings/html5/>HTML5
</a><i class="fa fa-circle-thin read-icon"></i></div></li><li data-nav-id=https://kwiksher.github.io/kwik5docs/design/project_model/settings/linux/ class=dd-item><div><a href=/kwik5docs/design/project_model/settings/linux/>Linux
</a><i class="fa fa-circle-thin read-icon"></i></div></li></ul></li><li data-nav-id=https://kwiksher.github.io/kwik5docs/design/project_model/template/ class=dd-item><div><a href=/kwik5docs/design/project_model/template/>Template strurcture
</a><i class="fa fa-circle-thin read-icon"></i></div></li><li data-nav-id=https://kwiksher.github.io/kwik5docs/design/project_model/template_model/ class=dd-item><div><a href=/kwik5docs/design/project_model/template_model/>Template Model
</a><i class="fa fa-circle-thin read-icon"></i></div></li></ul></li><li data-nav-id=https://kwiksher.github.io/kwik5docs/design/tools/ class="dd-item haschildren"><div><a href=/kwik5docs/design/tools/>Tools</a><i class="fa fa-angle-right fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i></div><ul><li data-nav-id=https://kwiksher.github.io/kwik5docs/design/tools/builder/ class=dd-item><div><a href=/kwik5docs/design/tools/builder/>Command line Build
</a><i class="fa fa-circle-thin read-icon"></i></div></li><li data-nav-id=https://kwiksher.github.io/kwik5docs/design/tools/plugins/ class=dd-item><div><a href=/kwik5docs/design/tools/plugins/>UXP Plugins
</a><i class="fa fa-circle-thin read-icon"></i></div></li><li data-nav-id=https://kwiksher.github.io/kwik5docs/design/tools/editor/ class=dd-item><div><a href=/kwik5docs/design/tools/editor/>Editor
</a><i class="fa fa-circle-thin read-icon"></i></div></li><li data-nav-id=https://kwiksher.github.io/kwik5docs/design/tools/webapp/ class=dd-item><div><a href=/kwik5docs/design/tools/webapp/>REST Server
</a><i class="fa fa-circle-thin read-icon"></i></div></li><li data-nav-id=https://kwiksher.github.io/kwik5docs/design/tools/utilities/ class=dd-item><div><a href=/kwik5docs/design/tools/utilities/>Utilities
</a><i class="fa fa-circle-thin read-icon"></i></div></li></ul></li><li data-nav-id=https://kwiksher.github.io/kwik5docs/design/workflow/ class="dd-item haschildren"><div><a href=/kwik5docs/design/workflow/>Workflow</a><i class="fa fa-angle-right fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i></div><ul><li data-nav-id=https://kwiksher.github.io/kwik5docs/design/workflow/lua/ class=dd-item><div><a href=/kwik5docs/design/workflow/lua/>Lua Code
</a><i class="fa fa-circle-thin read-icon"></i></div></li><li data-nav-id=https://kwiksher.github.io/kwik5docs/design/workflow/workflow/ class=dd-item><div><a href=/kwik5docs/design/workflow/workflow/>REST API
</a><i class="fa fa-circle-thin read-icon"></i></div></li></ul></li><li data-nav-id=https://kwiksher.github.io/kwik5docs/design/class/ class="dd-item haschildren"><div><a href=/kwik5docs/design/class/>Class Diagrams</a><i class="fa fa-angle-right fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i></div><ul><li data-nav-id=https://kwiksher.github.io/kwik5docs/design/class/class_animation/ class=dd-item><div><a href=/kwik5docs/design/class/class_animation/>Animation Editor
</a><i class="fa fa-circle-thin read-icon"></i></div></li><li data-nav-id=https://kwiksher.github.io/kwik5docs/design/class/class_group/ class=dd-item><div><a href=/kwik5docs/design/class/class_group/>Group Editor
</a><i class="fa fa-circle-thin read-icon"></i></div></li><li data-nav-id=https://kwiksher.github.io/kwik5docs/design/class/class/ class=dd-item><div><a href=/kwik5docs/design/class/class/>Timer Editor
</a><i class="fa fa-circle-thin read-icon"></i></div></li></ul></li><li data-nav-id=https://kwiksher.github.io/kwik5docs/design/sample-projects/ class=dd-item><div><a href=/kwik5docs/design/sample-projects/>Sample Projects</a><i class="fa fa-circle-thin read-icon"></i></div></li><li data-nav-id=https://kwiksher.github.io/kwik5docs/design/new_features/ class=dd-item><div><a href=/kwik5docs/design/new_features/>New Features
</a><i class="fa fa-circle-thin read-icon"></i></div></li></ul></li><li data-nav-id=https://kwiksher.github.io/kwik5docs/bookstore/ class="dd-item haschildren"><div><a href=/kwik5docs/bookstore/>Bookstore</a><i class="fa fa-angle-right fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i></div><ul><li data-nav-id=https://kwiksher.github.io/kwik5docs/bookstore/components/ class=dd-item><div><a href=/kwik5docs/bookstore/components/>Components
</a><i class="fa fa-circle-thin read-icon"></i></div></li><li data-nav-id=https://kwiksher.github.io/kwik5docs/bookstore/steps/ class=dd-item><div><a href=/kwik5docs/bookstore/steps/>Steps
</a><i class="fa fa-circle-thin read-icon"></i></div></li><li data-nav-id=https://kwiksher.github.io/kwik5docs/bookstore/server/ class=dd-item><div><a href=/kwik5docs/bookstore/server/>Book Server
</a><i class="fa fa-circle-thin read-icon"></i></div></li><li data-nav-id=https://kwiksher.github.io/kwik5docs/bookstore/simulator/ class=dd-item><div><a href=/kwik5docs/bookstore/simulator/>Simulator
</a><i class="fa fa-circle-thin read-icon"></i></div></li><li data-nav-id=https://kwiksher.github.io/kwik5docs/bookstore/versions/ class=dd-item><div><a href=/kwik5docs/bookstore/versions/>Book Versions
</a><i class="fa fa-circle-thin read-icon"></i></div></li></ul></li><li data-nav-id=https://kwiksher.github.io/kwik5docs/implementation/ class="dd-item haschildren"><div><a href=/kwik5docs/implementation/>Implementation</a><i class="fa fa-angle-right fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i></div><ul><li data-nav-id=https://kwiksher.github.io/kwik5docs/implementation/audio_editor/ class=dd-item><div><a href=/kwik5docs/implementation/audio_editor/>Audio Editor
</a><i class="fa fa-circle-thin read-icon"></i></div></li><li data-nav-id=https://kwiksher.github.io/kwik5docs/implementation/adding_component/ class=dd-item><div><a href=/kwik5docs/implementation/adding_component/>Adding A Component
</a><i class="fa fa-circle-thin read-icon"></i></div></li><li data-nav-id=https://kwiksher.github.io/kwik5docs/implementation/btree/ class=dd-item><div><a href=/kwik5docs/implementation/btree/>Behavior Tree
</a><i class="fa fa-circle-thin read-icon"></i></div></li><li data-nav-id=https://kwiksher.github.io/kwik5docs/implementation/selectors/ class=dd-item><div><a href=/kwik5docs/implementation/selectors/>Selectors
</a><i class="fa fa-circle-thin read-icon"></i></div></li><li data-nav-id=https://kwiksher.github.io/kwik5docs/implementation/rest_server/ class=dd-item><div><a href=/kwik5docs/implementation/rest_server/>REST Server
</a><i class="fa fa-circle-thin read-icon"></i></div></li></ul></li><li data-nav-id=https://kwiksher.github.io/kwik5docs/all/ class=dd-item><div><a href=/kwik5docs/all/>all</a><i class="fa fa-circle-thin read-icon"></i></div></li></ul><section></section></aside><section class=page><div class=nav-select><center>Navigation :
<select onchange="location.href=this.value"><option value=/kwik5docs/introduction/>
Introduction</option><option value=/kwik5docs/get_started/>
Get Started</option><option value=/kwik5docs/design/>
Design</option><option value=/kwik5docs/bookstore/>
Bookstore</option><option value=/kwik5docs/implementation/ selected>
Implementation</option><option value=/kwik5docs/all/>
all</option></select></center></div><div><div class=searchbox><input data-search-input id=search-by type=text placeholder></div></div><div align=right>Last Modified: 2023-05-08</div><p>TODO</p><pre tabindex=0><code>editor/controller/save.lua
editor/parts/controller/properties/save.lua
</code></pre><h2 id=implementation-details>implementation Details</h2><p>the following functions in editor.controller.index class are mainly used for CRUD of json/lua files in select, save, delete etc. See editor.controller.save.</p><p>separate controllers for the audio, group, timer and variable components are implemented i.e</p><ul><li>useClassEditorProps</li><li>setValue</li><li>render</li><li>save</li><li>read</li></ul><nav id=TableOfContents><ul><li><a href=#implementation-details>implementation Details</a><ul><li><a href=#select-read>select (read)</a></li><li><a href=#uiscenemodel>UI.scene.model</a></li><li><a href=#save-write>save (write)</a></li></ul></li></ul></nav><h3 id=select-read>select (read)</h3><p>See editor.parts.controller directory. selectXXX lua reads json and displays a UI table. The data is passed by nanostore such as bookStore:set, pageStore:set.</p><blockquote><p>nanostore is used as an experimental usage</p></blockquote><ol><li><p>selectApp.lua</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lua data-lang=lua><span style=display:flex><span><span style=color:#00a8c8>local</span> <span style=color:#111>appFolder</span> <span style=color:#f92672>=</span> <span style=color:#111>params.appFolder</span> <span style=color:#f92672>or</span> <span style=color:#111>system.pathForFile</span><span style=color:#111>(</span> <span style=color:#d88200>&#34;App&#34;</span><span style=color:#111>,</span> <span style=color:#111>system.ResourceDirectory</span> <span style=color:#111>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>if</span> <span style=color:#111>params.useTinyfiledialogs</span> <span style=color:#00a8c8>then</span>
</span></span><span style=display:flex><span>  <span style=color:#111>appFolder</span> <span style=color:#f92672>=</span> <span style=color:#111>tfd.selectFolderDialog</span><span style=color:#111>({</span>
</span></span><span style=display:flex><span>    <span style=color:#111>title</span> <span style=color:#f92672>=</span> <span style=color:#d88200>&#34;select App folder&#34;</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>    <span style=color:#111>default_path</span> <span style=color:#f92672>=</span> <span style=color:#111>path</span>
</span></span><span style=display:flex><span>  <span style=color:#111>})</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>-- print(&#34;&#34;, appFolder)</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>if</span> <span style=color:#111>success</span> <span style=color:#00a8c8>then</span>
</span></span><span style=display:flex><span>  <span style=color:#00a8c8>local</span> <span style=color:#111>books</span> <span style=color:#f92672>=</span> <span style=color:#111>{}</span>
</span></span><span style=display:flex><span>  <span style=color:#00a8c8>for</span> <span style=color:#111>file</span> <span style=color:#00a8c8>in</span> <span style=color:#111>lfs.dir</span><span style=color:#111>(</span> <span style=color:#111>appFolder</span> <span style=color:#111>)</span> <span style=color:#00a8c8>do</span>
</span></span><span style=display:flex><span>    <span style=color:#00a8c8>if</span> <span style=color:#111>util.isDir</span><span style=color:#111>(</span><span style=color:#111>file</span><span style=color:#111>)</span> <span style=color:#00a8c8>then</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>-- print(&#34;&#34;,  &#34;Found file: &#34; .. file )</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>-- set them to nanostores</span>
</span></span><span style=display:flex><span>      <span style=color:#00a8c8>if</span> <span style=color:#111>file</span><span style=color:#111>:</span><span style=color:#111>len</span><span style=color:#111>()</span> <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>3</span> <span style=color:#f92672>and</span> <span style=color:#111>file</span> <span style=color:#f92672>~=</span><span style=color:#d88200>&#34;kwikEditor&#34;</span> <span style=color:#00a8c8>then</span>
</span></span><span style=display:flex><span>        <span style=color:#111>table.insert</span><span style=color:#111>(</span><span style=color:#111>books</span><span style=color:#111>,</span> <span style=color:#111>{</span><span style=color:#111>name</span> <span style=color:#f92672>=</span> <span style=color:#111>file</span><span style=color:#111>,</span> <span style=color:#111>path</span><span style=color:#f92672>=</span> <span style=color:#111>util.PATH</span><span style=color:#111>(</span><span style=color:#111>appFolder</span><span style=color:#f92672>..</span><span style=color:#d88200>&#34;/&#34;</span><span style=color:#f92672>..</span><span style=color:#111>file</span><span style=color:#111>)})</span>
</span></span><span style=display:flex><span>      <span style=color:#00a8c8>end</span>
</span></span><span style=display:flex><span>    <span style=color:#00a8c8>end</span>
</span></span><span style=display:flex><span>  <span style=color:#00a8c8>end</span>
</span></span><span style=display:flex><span>  <span style=color:#00a8c8>if</span> <span style=color:#f92672>#</span><span style=color:#111>books</span> <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span> <span style=color:#00a8c8>then</span>
</span></span><span style=display:flex><span>    <span style=color:#111>UI.editor</span><span style=color:#111>.</span><span style=color:#111>bookStore</span><span style=color:#111>:</span><span style=color:#111>set</span><span style=color:#111>(</span><span style=color:#111>books</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>  <span style=color:#00a8c8>end</span>
</span></span></code></pre></div></li><li><p>selectBook.lua</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lua data-lang=lua><span style=display:flex><span><span style=color:#00a8c8>local</span> <span style=color:#111>path</span> <span style=color:#f92672>=</span><span style=color:#111>system.pathForFile</span><span style=color:#111>(</span> <span style=color:#d88200>&#34;App/&#34;</span><span style=color:#f92672>..</span><span style=color:#111>bookName</span><span style=color:#f92672>..</span><span style=color:#d88200>&#34;/models&#34;</span><span style=color:#111>,</span> <span style=color:#111>system.ResourceDirectory</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#111>UI.editor</span><span style=color:#111>.</span><span style=color:#111>currentBook</span> <span style=color:#f92672>=</span> <span style=color:#111>bookName</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>local</span> <span style=color:#111>success</span> <span style=color:#f92672>=</span> <span style=color:#111>lfs.chdir</span><span style=color:#111>(</span> <span style=color:#111>path</span> <span style=color:#111>)</span> <span style=color:#75715e>-- isDir works with current dir</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>if</span> <span style=color:#111>success</span> <span style=color:#00a8c8>then</span>
</span></span><span style=display:flex><span>  <span style=color:#00a8c8>local</span> <span style=color:#111>pages</span> <span style=color:#f92672>=</span> <span style=color:#111>{}</span>
</span></span><span style=display:flex><span>  <span style=color:#00a8c8>for</span> <span style=color:#111>file</span> <span style=color:#00a8c8>in</span> <span style=color:#111>lfs.dir</span><span style=color:#111>(</span> <span style=color:#111>path</span> <span style=color:#111>)</span> <span style=color:#00a8c8>do</span>
</span></span><span style=display:flex><span>    <span style=color:#00a8c8>if</span> <span style=color:#111>util.isDir</span><span style=color:#111>(</span><span style=color:#111>file</span><span style=color:#111>)</span> <span style=color:#00a8c8>then</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>-- set them to nanostores</span>
</span></span><span style=display:flex><span>      <span style=color:#00a8c8>if</span> <span style=color:#111>file</span><span style=color:#111>:</span><span style=color:#111>len</span><span style=color:#111>()</span> <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>3</span> <span style=color:#f92672>and</span> <span style=color:#111>file</span> <span style=color:#f92672>~=</span><span style=color:#d88200>&#39;assets&#39;</span> <span style=color:#00a8c8>then</span>
</span></span><span style=display:flex><span>        <span style=color:#111>table.insert</span><span style=color:#111>(</span><span style=color:#111>pages</span><span style=color:#111>,</span> <span style=color:#111>{</span><span style=color:#111>name</span> <span style=color:#f92672>=</span> <span style=color:#111>file</span><span style=color:#111>,</span> <span style=color:#111>path</span><span style=color:#f92672>=</span> <span style=color:#111>util.PATH</span><span style=color:#111>(</span><span style=color:#111>path</span><span style=color:#f92672>..</span><span style=color:#d88200>&#34;/&#34;</span><span style=color:#f92672>..</span><span style=color:#111>file</span><span style=color:#111>)})</span>
</span></span><span style=display:flex><span>      <span style=color:#00a8c8>end</span>
</span></span><span style=display:flex><span>    <span style=color:#00a8c8>end</span>
</span></span><span style=display:flex><span>  <span style=color:#00a8c8>end</span>
</span></span><span style=display:flex><span>  <span style=color:#00a8c8>if</span> <span style=color:#f92672>#</span><span style=color:#111>pages</span> <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span> <span style=color:#00a8c8>then</span>
</span></span><span style=display:flex><span>    <span style=color:#111>UI.editor</span><span style=color:#111>.</span><span style=color:#111>pageStore</span><span style=color:#111>:</span><span style=color:#111>set</span><span style=color:#111>(</span><span style=color:#111>pages</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>  <span style=color:#00a8c8>end</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>end</span>
</span></span></code></pre></div></li><li><p>selectPage.lua</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lua data-lang=lua><span style=display:flex><span><span style=color:#00a8c8>if</span> <span style=color:#111>params.page</span><span style=color:#111>:</span><span style=color:#111>len</span><span style=color:#111>()</span> <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>and</span> <span style=color:#111>UI.page</span> <span style=color:#f92672>~=</span> <span style=color:#111>params.page</span> <span style=color:#00a8c8>then</span>
</span></span><span style=display:flex><span>  <span style=color:#00a8c8>local</span> <span style=color:#111>app</span> <span style=color:#f92672>=</span> <span style=color:#111>App.get</span><span style=color:#111>()</span>
</span></span><span style=display:flex><span>  <span style=color:#111>app</span><span style=color:#111>:</span><span style=color:#111>showView</span><span style=color:#111>(</span><span style=color:#d88200>&#34;components.&#34;</span> <span style=color:#f92672>..</span> <span style=color:#111>params.page</span> <span style=color:#f92672>..</span> <span style=color:#d88200>&#34;.index&#34;</span><span style=color:#111>,</span> <span style=color:#111>{</span><span style=color:#111>effect</span> <span style=color:#f92672>=</span> <span style=color:#d88200>&#34;slideDown&#34;</span><span style=color:#111>})</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>end</span>
</span></span></code></pre></div></li></ol><ul><li><p>selectLayer.lua</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lua data-lang=lua><span style=display:flex><span><span style=color:#00a8c8>local</span> <span style=color:#111>path</span> <span style=color:#f92672>=</span> <span style=color:#111>system.pathForFile</span><span style=color:#111>(</span> <span style=color:#d88200>&#34;App/&#34;</span><span style=color:#f92672>..</span><span style=color:#111>UI.editor</span><span style=color:#111>.</span><span style=color:#111>currentBook</span><span style=color:#f92672>..</span><span style=color:#d88200>&#34;/models/&#34;</span><span style=color:#f92672>..</span><span style=color:#111>UI.page</span> <span style=color:#f92672>..</span><span style=color:#d88200>&#34;/&#34;</span><span style=color:#f92672>..</span><span style=color:#111>params.path</span><span style=color:#f92672>..</span><span style=color:#111>getFileName</span><span style=color:#111>(</span><span style=color:#111>layerName</span><span style=color:#111>,</span> <span style=color:#111>className</span><span style=color:#111>)</span><span style=color:#f92672>..</span><span style=color:#d88200>&#34;.json&#34;</span><span style=color:#111>,</span> <span style=color:#111>system.ResourceDirectory</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#111>...</span>
</span></span><span style=display:flex><span><span style=color:#111>propsTable</span><span style=color:#111>:</span><span style=color:#111>setValue</span><span style=color:#111>(</span><span style=color:#111>decoded</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#111>...</span>
</span></span></code></pre></div><blockquote><p>instead of nanostore, a traditional set/get functions are used here</p></blockquote><ul><li><p>selectTool.lua</p><p>this loads class&rsquo;s properties of a layer</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lua data-lang=lua><span style=display:flex><span> <span style=color:#00a8c8>if</span> <span style=color:#111>params.layer</span> <span style=color:#00a8c8>then</span> <span style=color:#75715e>-- this measn user clicks one of class, anim, button, drag ...</span>
</span></span><span style=display:flex><span>    <span style=color:#111>UI.editor</span><span style=color:#111>.</span><span style=color:#111>currentLayer</span> <span style=color:#f92672>=</span> <span style=color:#111>params.layer</span>
</span></span><span style=display:flex><span> <span style=color:#00a8c8>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> <span style=color:#111>tool.controller</span><span style=color:#111>:</span><span style=color:#111>read</span><span style=color:#111>(</span><span style=color:#111>UI.editor</span><span style=color:#111>.</span><span style=color:#111>currentBook</span><span style=color:#111>,</span> <span style=color:#111>UI.page</span><span style=color:#111>,</span> <span style=color:#111>UI.editor</span><span style=color:#111>.</span><span style=color:#111>currentLayer</span><span style=color:#111>,</span> <span style=color:#111>params.isNew</span><span style=color:#111>,</span> <span style=color:#111>params.class</span><span style=color:#111>)</span>
</span></span></code></pre></div><p>if params.isNew then it loads default values to propsTable</p><ul><li><p>edtior.controller.index</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lua data-lang=lua><span style=display:flex><span><span style=color:#00a8c8>function</span> <span style=color:#75af00>M</span><span style=color:#111>:</span><span style=color:#75af00>read</span><span style=color:#111>(</span><span style=color:#111>book</span><span style=color:#111>,</span> <span style=color:#111>page</span><span style=color:#111>,</span> <span style=color:#111>layer</span><span style=color:#111>,</span> <span style=color:#111>isNew</span><span style=color:#111>,</span> <span style=color:#111>class</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>  <span style=color:#111>print</span><span style=color:#111>(</span><span style=color:#d88200>&#34;read&#34;</span><span style=color:#111>,</span> <span style=color:#111>page</span><span style=color:#111>,</span> <span style=color:#111>layer</span><span style=color:#111>,</span> <span style=color:#111>isNew</span><span style=color:#111>,</span> <span style=color:#111>class</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>-- the values are used in useClassEdtiorProps()</span>
</span></span><span style=display:flex><span>  <span style=color:#111>self.page</span> <span style=color:#f92672>=</span> <span style=color:#111>page</span>
</span></span><span style=display:flex><span>  <span style=color:#111>self.layer</span> <span style=color:#f92672>=</span> <span style=color:#111>layer</span>
</span></span><span style=display:flex><span>  <span style=color:#111>self.isNew</span> <span style=color:#f92672>=</span> <span style=color:#111>isNew</span>
</span></span><span style=display:flex><span>  <span style=color:#111>self.class</span> <span style=color:#f92672>=</span> <span style=color:#111>class</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#00a8c8>if</span> <span style=color:#111>isNew</span> <span style=color:#00a8c8>then</span>
</span></span><span style=display:flex><span>    <span style=color:#00a8c8>local</span> <span style=color:#111>path</span> <span style=color:#f92672>=</span> <span style=color:#d88200>&#34;editor.template.components.pageX.&#34;</span><span style=color:#f92672>..</span><span style=color:#111>self.layerTool</span><span style=color:#f92672>..</span><span style=color:#d88200>&#34;.defaults.&#34;</span><span style=color:#f92672>..</span><span style=color:#111>class</span>
</span></span><span style=display:flex><span>    <span style=color:#00a8c8>local</span> <span style=color:#111>template</span> <span style=color:#f92672>=</span> <span style=color:#111>require</span><span style=color:#111>(</span><span style=color:#111>path</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>    <span style=color:#111>self</span><span style=color:#111>:</span><span style=color:#111>reset</span><span style=color:#111>()</span>
</span></span><span style=display:flex><span>    <span style=color:#111>self</span><span style=color:#111>:</span><span style=color:#111>setValue</span><span style=color:#111>(</span><span style=color:#111>template</span><span style=color:#111>,</span> <span style=color:#00a8c8>nil</span><span style=color:#111>,</span> <span style=color:#00a8c8>true</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>    <span style=color:#111>self</span><span style=color:#111>:</span><span style=color:#111>redraw</span><span style=color:#111>()</span>
</span></span><span style=display:flex><span>  <span style=color:#00a8c8>elseif</span> <span style=color:#111>layer</span> <span style=color:#00a8c8>then</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>-- this comes from clicking layerTable.class</span>
</span></span><span style=display:flex><span>    <span style=color:#00a8c8>local</span> <span style=color:#111>layerName</span> <span style=color:#f92672>=</span> <span style=color:#111>layer</span> <span style=color:#f92672>or</span> <span style=color:#d88200>&#34;index&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>--local path      = page ..&#34;/&#34;..layerName..&#34;_&#34;..self.layerTool..&#34;.json&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#00a8c8>local</span> <span style=color:#111>path</span>      <span style=color:#f92672>=</span> <span style=color:#111>system.pathForFile</span><span style=color:#111>(</span> <span style=color:#d88200>&#34;App/&#34;</span><span style=color:#f92672>..</span><span style=color:#111>book</span><span style=color:#f92672>..</span><span style=color:#d88200>&#34;/models/&#34;</span><span style=color:#f92672>..</span><span style=color:#111>page</span> <span style=color:#f92672>..</span><span style=color:#d88200>&#34;/&#34;</span><span style=color:#f92672>..</span><span style=color:#111>layerName</span><span style=color:#f92672>..</span><span style=color:#d88200>&#34;_&#34;</span><span style=color:#f92672>..</span><span style=color:#111>self.layerTool</span><span style=color:#f92672>..</span><span style=color:#d88200>&#34;.json&#34;</span><span style=color:#111>,</span> <span style=color:#111>system.ResourceDirectory</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>    <span style=color:#00a8c8>if</span> <span style=color:#111>self.lastSelection</span> <span style=color:#f92672>~=</span> <span style=color:#111>path</span> <span style=color:#00a8c8>then</span>
</span></span><span style=display:flex><span>      <span style=color:#111>self.lastSelection</span>   <span style=color:#f92672>=</span> <span style=color:#111>path</span>
</span></span><span style=display:flex><span>      <span style=color:#00a8c8>local</span> <span style=color:#111>decoded</span><span style=color:#111>,</span>  <span style=color:#111>pos</span><span style=color:#111>,</span> <span style=color:#111>msg</span> <span style=color:#f92672>=</span> <span style=color:#111>json.decodeFile</span><span style=color:#111>(</span> <span style=color:#111>path</span> <span style=color:#111>)</span>
</span></span><span style=display:flex><span>      <span style=color:#00a8c8>if</span> <span style=color:#f92672>not</span> <span style=color:#111>decoded</span> <span style=color:#00a8c8>then</span>
</span></span><span style=display:flex><span>          <span style=color:#111>print</span><span style=color:#111>(</span> <span style=color:#d88200>&#34;Decode failed at &#34;</span><span style=color:#f92672>..</span><span style=color:#111>tostring</span><span style=color:#111>(</span><span style=color:#111>pos</span><span style=color:#111>)</span><span style=color:#f92672>..</span><span style=color:#d88200>&#34;: &#34;</span><span style=color:#f92672>..</span><span style=color:#111>tostring</span><span style=color:#111>(</span><span style=color:#111>msg</span><span style=color:#111>)</span> <span style=color:#111>)</span>
</span></span><span style=display:flex><span>      <span style=color:#00a8c8>else</span>
</span></span><span style=display:flex><span>          <span style=color:#111>print</span><span style=color:#111>(</span> <span style=color:#d88200>&#34;File successfully decoded!&#34;</span> <span style=color:#111>)</span>
</span></span><span style=display:flex><span>      <span style=color:#00a8c8>end</span>
</span></span><span style=display:flex><span>      <span style=color:#111>self</span><span style=color:#111>:</span><span style=color:#111>reset</span><span style=color:#111>()</span>
</span></span><span style=display:flex><span>      <span style=color:#111>self</span><span style=color:#111>:</span><span style=color:#111>setValue</span><span style=color:#111>(</span><span style=color:#111>decoded</span><span style=color:#111>,</span> <span style=color:#ae81ff>1</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>      <span style=color:#111>self</span><span style=color:#111>:</span><span style=color:#111>redraw</span><span style=color:#111>()</span>
</span></span><span style=display:flex><span>    <span style=color:#00a8c8>else</span>
</span></span><span style=display:flex><span>      <span style=color:#111>self.view</span><span style=color:#111>.</span><span style=color:#111>isNew</span> <span style=color:#f92672>=</span> <span style=color:#00a8c8>true</span>
</span></span><span style=display:flex><span>      <span style=color:#111>toolbar</span><span style=color:#111>:</span><span style=color:#111>toogleToolMap</span><span style=color:#111>()</span>
</span></span><span style=display:flex><span>    <span style=color:#00a8c8>end</span>
</span></span><span style=display:flex><span>  <span style=color:#00a8c8>end</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>end</span>
</span></span></code></pre></div></li></ul><p>For layer&rsquo;s class, the json is retrived by <strong>tool.controller:read</strong> above and the read function calls setValue(decoded) inside to display the data to controlProps table.</p><ul><li><p>editor.controller.index</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lua data-lang=lua><span style=display:flex><span><span style=color:#00a8c8>function</span> <span style=color:#75af00>M</span><span style=color:#111>:</span><span style=color:#75af00>setValue</span><span style=color:#111>(</span><span style=color:#111>decoded</span><span style=color:#111>,</span> <span style=color:#111>index</span><span style=color:#111>,</span> <span style=color:#111>template</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>  <span style=color:#00a8c8>if</span> <span style=color:#111>decoded</span> <span style=color:#f92672>==</span> <span style=color:#00a8c8>nil</span> <span style=color:#00a8c8>then</span> <span style=color:#00a8c8>return</span> <span style=color:#00a8c8>end</span>
</span></span><span style=display:flex><span>  <span style=color:#00a8c8>if</span> <span style=color:#f92672>not</span> <span style=color:#111>template</span> <span style=color:#00a8c8>then</span>
</span></span><span style=display:flex><span>    <span style=color:#111>print</span><span style=color:#111>(</span><span style=color:#111>json.encode</span><span style=color:#111>(</span><span style=color:#111>decoded</span><span style=color:#111>[</span><span style=color:#111>index</span><span style=color:#111>]))</span>
</span></span><span style=display:flex><span>    <span style=color:#111>self.selectbox</span><span style=color:#111>:</span><span style=color:#111>setValue</span><span style=color:#111>(</span><span style=color:#111>decoded</span><span style=color:#111>,</span> <span style=color:#111>index</span><span style=color:#111>)</span>  <span style=color:#75715e>-- &#34;linear 1&#34;, &#34;rotation 1&#34; ...</span>
</span></span><span style=display:flex><span>    <span style=color:#111>self.controlProps</span><span style=color:#111>:</span><span style=color:#111>setValue</span><span style=color:#111>(</span><span style=color:#111>decoded</span><span style=color:#111>[</span><span style=color:#111>index</span><span style=color:#111>].</span><span style=color:#111>controls</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>    <span style=color:#111>self.onCompletebox</span><span style=color:#111>:</span><span style=color:#111>setValue</span><span style=color:#111>(</span><span style=color:#111>decoded</span><span style=color:#111>[</span><span style=color:#111>index</span><span style=color:#111>].</span><span style=color:#111>actionName</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>  <span style=color:#00a8c8>else</span>
</span></span><span style=display:flex><span>    <span style=color:#111>self.selectbox</span><span style=color:#111>:</span><span style=color:#111>setTemplate</span><span style=color:#111>(</span><span style=color:#111>decoded</span><span style=color:#111>)</span>  <span style=color:#75715e>-- &#34;linear 1&#34;, &#34;rotation 1&#34; ...</span>
</span></span><span style=display:flex><span>    <span style=color:#111>self.controlProps</span><span style=color:#111>:</span><span style=color:#111>setValue</span><span style=color:#111>(</span><span style=color:#111>decoded.controls</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>    <span style=color:#111>self.onCompletebox</span><span style=color:#111>:</span><span style=color:#111>setValue</span><span style=color:#111>(</span><span style=color:#111>decoded.actionName</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>  <span style=color:#00a8c8>end</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>end</span>
</span></span></code></pre></div><p>generic setValue is implemented in edtior.controller.index, and components can have own setValue for their UI table. for instance,</p><ul><li>editor/animation/controller.lua</li><li>editor/replacement/controller/index.lua</li></ul></li></ul></li></ul></li></ul><hr><ul><li><p>editor.controller.index</p><p>the command() reads json with util.decode() from params.</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lua data-lang=lua><span style=display:flex><span><span style=color:#00a8c8>function</span> <span style=color:#75af00>M</span><span style=color:#111>:</span><span style=color:#75af00>command</span><span style=color:#111>()</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>local</span> <span style=color:#111>instance</span> <span style=color:#f92672>=</span> <span style=color:#111>require</span><span style=color:#111>(</span><span style=color:#d88200>&#34;commands.kwik.baseCommand&#34;</span><span style=color:#111>).</span><span style=color:#111>new</span><span style=color:#111>(</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>function</span> <span style=color:#111>(</span><span style=color:#111>params</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>  <span style=color:#00a8c8>local</span> <span style=color:#111>UI</span>    <span style=color:#f92672>=</span> <span style=color:#111>params.UI</span>
</span></span><span style=display:flex><span>  <span style=color:#00a8c8>local</span> <span style=color:#111>name</span> <span style=color:#f92672>=</span>  <span style=color:#111>params</span><span style=color:#111>[</span><span style=color:#111>params.class</span><span style=color:#111>]</span> <span style=color:#f92672>or</span> <span style=color:#d88200>&#34;&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#00a8c8>local</span> <span style=color:#111>decoded</span> <span style=color:#f92672>=</span> <span style=color:#111>util.decode</span><span style=color:#111>(</span><span style=color:#111>params</span><span style=color:#111>)</span> <span style=color:#75715e>-- this reads models/xx.json</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>--</span>
</span></span><span style=display:flex><span>  <span style=color:#111>print</span><span style=color:#111>(</span><span style=color:#d88200>&#34;From selectors&#34;</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>  <span style=color:#111>self.controlProps</span><span style=color:#111>:</span><span style=color:#111>didHide</span><span style=color:#111>(</span><span style=color:#111>UI</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>  <span style=color:#111>self.controlProps</span><span style=color:#111>:</span><span style=color:#111>destroy</span><span style=color:#111>(</span><span style=color:#111>UI</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>  <span style=color:#111>self.controlProps</span><span style=color:#111>:</span><span style=color:#111>init</span><span style=color:#111>(</span><span style=color:#111>UI</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>  <span style=color:#111>self.controlProps</span><span style=color:#111>:</span><span style=color:#111>setValue</span><span style=color:#111>(</span><span style=color:#111>decoded</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>  <span style=color:#111>self.controlProps</span><span style=color:#111>.</span><span style=color:#111>isNew</span> <span style=color:#f92672>=</span> <span style=color:#111>params.isNew</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>--</span>
</span></span><span style=display:flex><span>  <span style=color:#111>self.controlProps</span><span style=color:#111>:</span><span style=color:#111>create</span><span style=color:#111>(</span><span style=color:#111>UI</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>  <span style=color:#111>self.controlProps</span><span style=color:#111>:</span><span style=color:#111>didShow</span><span style=color:#111>(</span><span style=color:#111>UI</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>--</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>-- self:show()</span>
</span></span><span style=display:flex><span>  <span style=color:#111>self.controlProps</span><span style=color:#111>:</span><span style=color:#111>show</span><span style=color:#111>()</span>
</span></span><span style=display:flex><span>  <span style=color:#111>self.onCompletebox</span><span style=color:#111>:</span><span style=color:#111>show</span><span style=color:#111>()</span>
</span></span><span style=display:flex><span>  <span style=color:#111>self.buttons</span><span style=color:#111>:</span><span style=color:#111>show</span><span style=color:#111>()</span>
</span></span><span style=display:flex><span> <span style=color:#111>...</span>
</span></span></code></pre></div><ul><li>util.decode</li></ul><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lua data-lang=lua><span style=display:flex><span><span style=color:#00a8c8>function</span>  <span style=color:#75af00>M</span><span style=color:#111>.</span><span style=color:#75af00>decode</span><span style=color:#111>(</span><span style=color:#111>params</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>  <span style=color:#00a8c8>local</span> <span style=color:#111>UI</span> <span style=color:#f92672>=</span> <span style=color:#111>params.UI</span>
</span></span><span style=display:flex><span>  <span style=color:#00a8c8>if</span> <span style=color:#111>params.isNew</span> <span style=color:#00a8c8>then</span>
</span></span><span style=display:flex><span>    <span style=color:#00a8c8>local</span> <span style=color:#111>path</span> <span style=color:#f92672>=</span> <span style=color:#d88200>&#34;editor.template.components.pageX.&#34;</span><span style=color:#f92672>..</span><span style=color:#111>params.class</span><span style=color:#f92672>..</span><span style=color:#d88200>&#34;.defaults.&#34;</span><span style=color:#f92672>..</span><span style=color:#111>params.class</span>
</span></span><span style=display:flex><span>    <span style=color:#00a8c8>return</span>  <span style=color:#111>require</span><span style=color:#111>(</span><span style=color:#111>path</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>  <span style=color:#00a8c8>elseif</span> <span style=color:#111>params.isDelete</span> <span style=color:#00a8c8>then</span>
</span></span><span style=display:flex><span>    <span style=color:#111>print</span><span style=color:#111>(</span><span style=color:#111>params.class</span><span style=color:#111>,</span> <span style=color:#d88200>&#34;delete&#34;</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>    <span style=color:#00a8c8>return</span> <span style=color:#111>{}</span>
</span></span><span style=display:flex><span>  <span style=color:#00a8c8>else</span>
</span></span><span style=display:flex><span>    <span style=color:#00a8c8>local</span> <span style=color:#111>name</span> <span style=color:#f92672>=</span> <span style=color:#111>params</span><span style=color:#111>[</span><span style=color:#111>params.class</span><span style=color:#111>]</span> <span style=color:#f92672>or</span> <span style=color:#d88200>&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#00a8c8>if</span> <span style=color:#111>params.subclass</span> <span style=color:#00a8c8>then</span>
</span></span><span style=display:flex><span>      <span style=color:#111>name</span> <span style=color:#f92672>=</span> <span style=color:#111>params.subclass</span><span style=color:#f92672>..</span><span style=color:#d88200>&#34;/&#34;</span><span style=color:#f92672>..</span><span style=color:#111>name</span>
</span></span><span style=display:flex><span>    <span style=color:#00a8c8>end</span>
</span></span><span style=display:flex><span>    <span style=color:#00a8c8>local</span> <span style=color:#111>path</span> <span style=color:#f92672>=</span> <span style=color:#111>system.pathForFile</span><span style=color:#111>(</span> <span style=color:#d88200>&#34;App/&#34;</span><span style=color:#f92672>..</span><span style=color:#111>UI.editor</span><span style=color:#111>.</span><span style=color:#111>currentBook</span><span style=color:#f92672>..</span><span style=color:#d88200>&#34;/models/&#34;</span><span style=color:#f92672>..</span><span style=color:#111>UI.page</span> <span style=color:#f92672>..</span><span style=color:#d88200>&#34;/&#34;</span><span style=color:#f92672>..</span><span style=color:#111>params.class</span><span style=color:#f92672>..</span><span style=color:#d88200>&#34;s/&#34;</span><span style=color:#f92672>..</span><span style=color:#111>name</span><span style=color:#f92672>..</span><span style=color:#d88200>&#34;.json&#34;</span><span style=color:#111>,</span> <span style=color:#111>system.ResourceDirectory</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>    <span style=color:#111>decoded</span><span style=color:#111>,</span> <span style=color:#111>pos</span><span style=color:#111>,</span> <span style=color:#111>msg</span> <span style=color:#f92672>=</span> <span style=color:#111>json.decodeFile</span><span style=color:#111>(</span> <span style=color:#111>path</span> <span style=color:#111>)</span>
</span></span><span style=display:flex><span>    <span style=color:#00a8c8>if</span> <span style=color:#f92672>not</span> <span style=color:#111>decoded</span> <span style=color:#00a8c8>then</span>
</span></span><span style=display:flex><span>      <span style=color:#111>print</span><span style=color:#111>(</span> <span style=color:#d88200>&#34;Decode failed at &#34;</span><span style=color:#f92672>..</span><span style=color:#111>tostring</span><span style=color:#111>(</span><span style=color:#111>pos</span><span style=color:#111>)</span><span style=color:#f92672>..</span><span style=color:#d88200>&#34;: &#34;</span><span style=color:#f92672>..</span><span style=color:#111>tostring</span><span style=color:#111>(</span><span style=color:#111>msg</span><span style=color:#111>),</span> <span style=color:#111>path</span> <span style=color:#111>)</span>
</span></span><span style=display:flex><span>      <span style=color:#111>decoded</span> <span style=color:#f92672>=</span> <span style=color:#111>{}</span>
</span></span><span style=display:flex><span>    <span style=color:#00a8c8>end</span>
</span></span><span style=display:flex><span>    <span style=color:#00a8c8>return</span> <span style=color:#111>decoded</span> <span style=color:#f92672>or</span> <span style=color:#111>{}</span>
</span></span><span style=display:flex><span>  <span style=color:#00a8c8>end</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>end</span>
</span></span></code></pre></div></li><li><p>selectAudio.lua</p><p>require(&ldquo;editor.audio.index&rdquo;).controller:command()</p></li><li><p>selectTimer.lua</p><p>require(&ldquo;editor.timer.index&rdquo;).controller:command()</p></li><li><p>selectVariable.lua</p><p>require(&ldquo;editor.variable.index&rdquo;).controller:command()</p></li></ul><hr><ul><li><p>selectGroup.lua</p><p>require(&ldquo;editor.group.controller.selectGroup&rdquo;)</p><p>selectGroup returns a command() for Group</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lua data-lang=lua><span style=display:flex><span><span style=color:#00a8c8>local</span> <span style=color:#111>command</span> <span style=color:#f92672>=</span> <span style=color:#00a8c8>function</span> <span style=color:#111>(</span><span style=color:#111>params</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span> <span style=color:#00a8c8>local</span> <span style=color:#111>UI</span>    <span style=color:#f92672>=</span> <span style=color:#111>params.UI</span>
</span></span><span style=display:flex><span> <span style=color:#00a8c8>local</span> <span style=color:#111>name</span> <span style=color:#f92672>=</span>  <span style=color:#111>params.group</span> <span style=color:#f92672>or</span> <span style=color:#d88200>&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> <span style=color:#111>print</span> <span style=color:#111>(</span><span style=color:#111>params.class</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span> <span style=color:#111>print</span><span style=color:#111>(</span><span style=color:#d88200>&#34;selectGroup&#34;</span><span style=color:#111>,</span> <span style=color:#111>name</span><span style=color:#111>,</span> <span style=color:#111>path</span><span style=color:#111>,</span> <span style=color:#111>params.show</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> <span style=color:#75715e>--print(debug.traceback())</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> <span style=color:#00a8c8>local</span> <span style=color:#111>tableData</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> <span style=color:#00a8c8>if</span> <span style=color:#111>params.isNew</span> <span style=color:#00a8c8>then</span>
</span></span><span style=display:flex><span>   <span style=color:#00a8c8>local</span> <span style=color:#111>boxData</span> <span style=color:#f92672>=</span> <span style=color:#111>util.read</span><span style=color:#111>(</span> <span style=color:#111>UI.editor</span><span style=color:#111>.</span><span style=color:#111>currentBook</span><span style=color:#111>,</span> <span style=color:#111>UI.page</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>   <span style=color:#75715e>--</span>
</span></span><span style=display:flex><span>   <span style=color:#111>tableData</span> <span style=color:#f92672>=</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>     <span style=color:#111>name</span> <span style=color:#f92672>=</span> <span style=color:#d88200>&#34;(new-group)&#34;</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>     <span style=color:#111>layers</span> <span style=color:#f92672>=</span> <span style=color:#111>{},</span>
</span></span><span style=display:flex><span>     <span style=color:#111>children</span> <span style=color:#f92672>=</span> <span style=color:#111>{},</span>
</span></span><span style=display:flex><span>     <span style=color:#111>alpha</span> <span style=color:#f92672>=</span>  <span style=color:#00a8c8>nil</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>     <span style=color:#111>xScale</span> <span style=color:#f92672>=</span>  <span style=color:#00a8c8>nil</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>     <span style=color:#111>yScale</span> <span style=color:#f92672>=</span>  <span style=color:#00a8c8>nil</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>     <span style=color:#111>rotation</span> <span style=color:#f92672>=</span>  <span style=color:#00a8c8>nil</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>     <span style=color:#111>isLuaTable</span> <span style=color:#f92672>=</span> <span style=color:#111>nll</span>
</span></span><span style=display:flex><span>   <span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   <span style=color:#111>UI.editor</span><span style=color:#111>.</span><span style=color:#111>groupLayersStore</span><span style=color:#111>:</span><span style=color:#111>set</span><span style=color:#111>(</span><span style=color:#111>tableData</span><span style=color:#111>)</span> <span style=color:#75715e>-- layersTable</span>
</span></span><span style=display:flex><span>   <span style=color:#111>UI.editor</span><span style=color:#111>.</span><span style=color:#111>layerJsonStore</span><span style=color:#111>:</span><span style=color:#111>set</span><span style=color:#111>(</span><span style=color:#111>boxData.layers</span><span style=color:#111>)</span> <span style=color:#75715e>-- layersbox</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> <span style=color:#00a8c8>elseif</span> <span style=color:#111>params.isDelete</span> <span style=color:#00a8c8>then</span>
</span></span><span style=display:flex><span> <span style=color:#00a8c8>elseif</span> <span style=color:#111>name</span><span style=color:#111>:</span><span style=color:#111>len</span><span style=color:#111>()</span> <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span> <span style=color:#00a8c8>then</span>
</span></span><span style=display:flex><span>   <span style=color:#75715e>--</span>
</span></span><span style=display:flex><span>   <span style=color:#75715e>-- layersTable</span>
</span></span><span style=display:flex><span>   <span style=color:#75715e>--</span>
</span></span><span style=display:flex><span>   <span style=color:#00a8c8>local</span> <span style=color:#111>path</span> <span style=color:#f92672>=</span> <span style=color:#111>system.pathForFile</span><span style=color:#111>(</span> <span style=color:#d88200>&#34;App/&#34;</span><span style=color:#f92672>..</span><span style=color:#111>UI.editor</span><span style=color:#111>.</span><span style=color:#111>currentBook</span><span style=color:#f92672>..</span><span style=color:#d88200>&#34;/models/&#34;</span><span style=color:#f92672>..</span><span style=color:#111>UI.page</span> <span style=color:#f92672>..</span><span style=color:#d88200>&#34;/groups/&#34;</span><span style=color:#f92672>..</span><span style=color:#111>name</span><span style=color:#f92672>..</span><span style=color:#d88200>&#34;.json&#34;</span><span style=color:#111>,</span> <span style=color:#111>system.ResourceDirectory</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>   <span style=color:#111>tableData</span><span style=color:#111>,</span> <span style=color:#111>pos</span><span style=color:#111>,</span> <span style=color:#111>msg</span> <span style=color:#f92672>=</span> <span style=color:#111>json.decodeFile</span><span style=color:#111>(</span> <span style=color:#111>path</span> <span style=color:#111>)</span>
</span></span><span style=display:flex><span>   <span style=color:#00a8c8>if</span> <span style=color:#f92672>not</span> <span style=color:#111>tableData</span> <span style=color:#00a8c8>then</span>
</span></span><span style=display:flex><span>     <span style=color:#111>print</span><span style=color:#111>(</span> <span style=color:#d88200>&#34;Decode failed at &#34;</span><span style=color:#f92672>..</span><span style=color:#111>tostring</span><span style=color:#111>(</span><span style=color:#111>pos</span><span style=color:#111>)</span><span style=color:#f92672>..</span><span style=color:#d88200>&#34;: &#34;</span><span style=color:#f92672>..</span><span style=color:#111>tostring</span><span style=color:#111>(</span><span style=color:#111>msg</span><span style=color:#111>),</span> <span style=color:#111>path</span> <span style=color:#111>)</span>
</span></span><span style=display:flex><span>     <span style=color:#111>tableData</span> <span style=color:#f92672>=</span> <span style=color:#111>{}</span>
</span></span><span style=display:flex><span>   <span style=color:#00a8c8>end</span>
</span></span><span style=display:flex><span>   <span style=color:#75715e>--</span>
</span></span><span style=display:flex><span>   <span style=color:#75715e>-- layersbox</span>
</span></span><span style=display:flex><span>   <span style=color:#75715e>--</span>
</span></span><span style=display:flex><span>   <span style=color:#00a8c8>local</span> <span style=color:#111>boxData</span> <span style=color:#f92672>=</span> <span style=color:#111>util.read</span><span style=color:#111>(</span> <span style=color:#111>UI.editor</span><span style=color:#111>.</span><span style=color:#111>currentBook</span><span style=color:#111>,</span> <span style=color:#111>UI.page</span><span style=color:#111>,</span> <span style=color:#00a8c8>function</span><span style=color:#111>(</span><span style=color:#111>parent</span><span style=color:#111>,</span> <span style=color:#111>name</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>     <span style=color:#75715e>-- let&#39;s remove entries of tableData from boxData</span>
</span></span><span style=display:flex><span>     <span style=color:#75715e>--    layers = [&#34;GroupA.Ellipse&#34;, &#34;GroupA.SubA.Triangle&#34;]</span>
</span></span><span style=display:flex><span>     <span style=color:#00a8c8>for</span> <span style=color:#111>i</span><span style=color:#f92672>=</span><span style=color:#ae81ff>1</span><span style=color:#111>,</span> <span style=color:#f92672>#</span><span style=color:#111>tableData.layers</span> <span style=color:#00a8c8>do</span>
</span></span><span style=display:flex><span>       <span style=color:#00a8c8>local</span> <span style=color:#111>_name</span> <span style=color:#f92672>=</span> <span style=color:#111>tableData.layers</span><span style=color:#111>[</span><span style=color:#111>i</span><span style=color:#111>]</span>
</span></span><span style=display:flex><span>       <span style=color:#00a8c8>if</span> <span style=color:#111>parent</span> <span style=color:#00a8c8>then</span>
</span></span><span style=display:flex><span>         <span style=color:#00a8c8>if</span> <span style=color:#111>parent</span> <span style=color:#f92672>..</span><span style=color:#d88200>&#34;.&#34;</span><span style=color:#f92672>..</span><span style=color:#111>name</span> <span style=color:#f92672>==</span> <span style=color:#111>_name</span> <span style=color:#00a8c8>then</span>
</span></span><span style=display:flex><span>           <span style=color:#00a8c8>return</span> <span style=color:#00a8c8>true</span>
</span></span><span style=display:flex><span>         <span style=color:#00a8c8>end</span>
</span></span><span style=display:flex><span>       <span style=color:#00a8c8>elseif</span> <span style=color:#111>name</span> <span style=color:#f92672>==</span> <span style=color:#111>_name</span> <span style=color:#00a8c8>then</span>
</span></span><span style=display:flex><span>         <span style=color:#00a8c8>return</span> <span style=color:#00a8c8>true</span>
</span></span><span style=display:flex><span>       <span style=color:#00a8c8>end</span>
</span></span><span style=display:flex><span>     <span style=color:#00a8c8>end</span>
</span></span><span style=display:flex><span>     <span style=color:#00a8c8>return</span> <span style=color:#00a8c8>false</span>
</span></span><span style=display:flex><span>   <span style=color:#00a8c8>end</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   <span style=color:#111>UI.editor</span><span style=color:#111>.</span><span style=color:#111>layerJsonStore</span><span style=color:#111>:</span><span style=color:#111>set</span><span style=color:#111>(</span><span style=color:#111>boxData.layers</span><span style=color:#111>)</span> <span style=color:#75715e>-- layersbox</span>
</span></span><span style=display:flex><span>   <span style=color:#111>UI.editor</span><span style=color:#111>.</span><span style=color:#111>groupLayersStore</span><span style=color:#111>:</span><span style=color:#111>set</span><span style=color:#111>(</span><span style=color:#111>tableData</span><span style=color:#111>)</span> <span style=color:#75715e>-- layersTable</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> <span style=color:#00a8c8>end</span>
</span></span><span style=display:flex><span> <span style=color:#75715e>--</span>
</span></span><span style=display:flex><span> <span style=color:#111>editor</span><span style=color:#111>:</span><span style=color:#111>show</span><span style=color:#111>()</span>
</span></span></code></pre></div></li><li><p>selectPageProps.lua</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lua data-lang=lua><span style=display:flex><span><span style=color:#00a8c8>local</span> <span style=color:#111>command</span> <span style=color:#f92672>=</span> <span style=color:#00a8c8>function</span> <span style=color:#111>(</span><span style=color:#111>params</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>  <span style=color:#111>...</span>
</span></span><span style=display:flex><span>  <span style=color:#00a8c8>local</span> <span style=color:#111>path</span> <span style=color:#f92672>=</span> <span style=color:#111>system.pathForFile</span><span style=color:#111>(</span> <span style=color:#d88200>&#34;App/&#34;</span><span style=color:#f92672>..</span><span style=color:#111>UI.editor</span><span style=color:#111>.</span><span style=color:#111>currentBook</span><span style=color:#f92672>..</span><span style=color:#d88200>&#34;/models/settings.json&#34;</span><span style=color:#111>,</span> <span style=color:#111>system.ResourceDirectory</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>  <span style=color:#111>...</span>
</span></span><span style=display:flex><span>  <span style=color:#111>settingsTable</span><span style=color:#111>:</span><span style=color:#111>setValue</span><span style=color:#111>(</span><span style=color:#111>decoded</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>  <span style=color:#111>...</span>
</span></span></code></pre></div></li></ul><p>create a new component from toolbar</p><ul><li>selectToolbar.lua</li></ul><hr><h3 id=uiscenemodel>UI.scene.model</h3><p>UI.scene.model is set when <strong>selectPage</strong> is called</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lua data-lang=lua><span style=display:flex><span><span style=color:#00a8c8>local</span> <span style=color:#111>scene</span> <span style=color:#f92672>=</span> <span style=color:#111>require</span><span style=color:#111>(</span><span style=color:#d88200>&#39;controller.scene&#39;</span><span style=color:#111>).</span><span style=color:#111>new</span><span style=color:#111>(</span><span style=color:#111>sceneName</span><span style=color:#111>,</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span><span style=color:#111>name</span> <span style=color:#f92672>=</span> <span style=color:#d88200>&#34;page1&#34;</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span><span style=color:#111>components</span> <span style=color:#f92672>=</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>  <span style=color:#111>layers</span> <span style=color:#f92672>=</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>        <span style=color:#111>{</span>  <span style=color:#111>bg</span><span style=color:#f92672>=</span><span style=color:#111>{</span>
</span></span><span style=display:flex><span>                          <span style=color:#111>}</span> <span style=color:#111>},</span>
</span></span><span style=display:flex><span>        <span style=color:#111>{</span>  <span style=color:#111>gotoBtn</span><span style=color:#f92672>=</span><span style=color:#111>{</span> <span style=color:#75715e>--class={&#34;animation&#34;}</span>
</span></span><span style=display:flex><span>                          <span style=color:#111>}</span> <span style=color:#111>},</span>
</span></span><span style=display:flex><span>        <span style=color:#111>{</span>  <span style=color:#111>title</span><span style=color:#f92672>=</span><span style=color:#111>{</span> <span style=color:#111>class</span><span style=color:#f92672>=</span><span style=color:#111>{</span><span style=color:#d88200>&#34;linear&#34;</span><span style=color:#111>}</span> <span style=color:#111>}</span> <span style=color:#111>},</span>
</span></span><span style=display:flex><span>  <span style=color:#111>},</span>
</span></span><span style=display:flex><span>  <span style=color:#111>audios</span> <span style=color:#f92672>=</span> <span style=color:#111>{},</span>
</span></span><span style=display:flex><span>  <span style=color:#111>groups</span> <span style=color:#f92672>=</span> <span style=color:#111>{},</span>
</span></span><span style=display:flex><span>  <span style=color:#111>timers</span> <span style=color:#f92672>=</span> <span style=color:#111>{},</span>
</span></span><span style=display:flex><span>  <span style=color:#111>variables</span> <span style=color:#f92672>=</span> <span style=color:#111>{},</span>
</span></span><span style=display:flex><span>  <span style=color:#111>page</span> <span style=color:#f92672>=</span> <span style=color:#111>{</span> <span style=color:#111>}</span>
</span></span><span style=display:flex><span><span style=color:#111>},</span>
</span></span><span style=display:flex><span><span style=color:#111>commands</span> <span style=color:#f92672>=</span> <span style=color:#111>{</span> <span style=color:#d88200>&#34;eventOne&#34;</span><span style=color:#111>,</span> <span style=color:#d88200>&#34;eventTwo&#34;</span><span style=color:#111>,</span> <span style=color:#d88200>&#34;act01&#34;</span> <span style=color:#111>},</span>
</span></span><span style=display:flex><span><span style=color:#111>onInit</span> <span style=color:#f92672>=</span> <span style=color:#00a8c8>function</span><span style=color:#111>(</span><span style=color:#111>scene</span><span style=color:#111>)</span> <span style=color:#111>print</span><span style=color:#111>(</span><span style=color:#d88200>&#34;onInit&#34;</span><span style=color:#111>)</span> <span style=color:#00a8c8>end</span>
</span></span><span style=display:flex><span><span style=color:#111>})</span>
</span></span></code></pre></div><p>util.read() function parses &ldquo;App/&rdquo;..book.."/models/"..page .."/index.json"</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lua data-lang=lua><span style=display:flex><span><span style=color:#111>...</span>
</span></span><span style=display:flex><span><span style=color:#111>ret.layers</span> <span style=color:#f92672>=</span> <span style=color:#111>parser</span><span style=color:#111>(</span><span style=color:#111>decoded</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#111>...</span>
</span></span><span style=display:flex><span><span style=color:#111>setFiles</span><span style=color:#111>(</span><span style=color:#111>ret.audios</span><span style=color:#111>,</span> <span style=color:#d88200>&#34;/audios/short&#34;</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#111>setFiles</span><span style=color:#111>(</span><span style=color:#111>ret.audios</span><span style=color:#111>,</span> <span style=color:#d88200>&#34;/audios/long&#34;</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#111>setFiles</span><span style=color:#111>(</span><span style=color:#111>ret.groups</span><span style=color:#111>,</span> <span style=color:#d88200>&#34;/groups&#34;</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#111>setFiles</span><span style=color:#111>(</span><span style=color:#111>ret.commands</span><span style=color:#111>,</span> <span style=color:#d88200>&#34;/commands&#34;</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>return</span> <span style=color:#111>ret</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lua data-lang=lua><span style=display:flex><span><span style=color:#111>{</span>
</span></span><span style=display:flex><span>  <span style=color:#111>layers</span> <span style=color:#f92672>=</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>    <span style=color:#111>{</span><span style=color:#111>name</span> <span style=color:#f92672>=</span> <span style=color:#d88200>&#34;layerOne&#34;</span><span style=color:#111>,</span> <span style=color:#111>parent</span><span style=color:#f92672>=</span><span style=color:#d88200>&#34;&#34;</span><span style=color:#111>,</span> <span style=color:#111>children</span> <span style=color:#f92672>=</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>        <span style=color:#111>{</span><span style=color:#111>name</span><span style=color:#f92672>=</span><span style=color:#d88200>&#34;childOne}, parent=&#34;</span><span style=color:#111>layerOne</span><span style=color:#d88200>&#34;, children = {}}
</span></span></span><span style=display:flex><span><span style=color:#d88200>      }
</span></span></span><span style=display:flex><span><span style=color:#d88200>    },
</span></span></span><span style=display:flex><span><span style=color:#d88200>    {name = &#34;</span><span style=color:#111>layerTwo</span><span style=color:#d88200>&#34;, parent=&#34;&#34;, children = {}},
</span></span></span><span style=display:flex><span><span style=color:#d88200>  },
</span></span></span><span style=display:flex><span><span style=color:#d88200>  audios = {}
</span></span></span><span style=display:flex><span><span style=color:#d88200>}
</span></span></span></code></pre></div><hr><h3 id=save-write>save (write)</h3><blockquote><p>CRUD operations on json/lua files are mainly for commands and components in a selected page</p></blockquote><blockquote><p>the editor does not support to create a new entry of App, Book, Page. The properties can be modified for App, Book, Page.</p></blockquote><ul><li>create/update a layer class<ul><li>get props</li><li>render App/booxX/components/pageX/layers/XXX.lua</li><li>save it as a json file</li></ul></li><li><strong>util.createIndexModel</strong> returns the updated scene model if a classname for a layer is newly added</li></ul><blockquote><p>layer names must be unique in a scene model.</p></blockquote><pre><code>```lua
util.createIndexModel(UI.scene.model, UI.editor.currentLayer, classname)
```

```lua
scene = {
  name = &quot;canvas&quot;,
  components = {
    layers = {
        {  back={
                          } },
        {  butBlue={ class={&quot;button&quot;}, {A={}}, {B={}}
                          } },
        {  butWhite={
                          } },
    },
    audios = {  },
    groups = {  },
    timers = {  },
    variables = {  },
    others = {  }
  },
}
```
- render App.booxX.components.pageX.index.lua
- save json
</code></pre><ul><li>editor.controller.save</li></ul><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lua data-lang=lua><span style=display:flex><span><span style=color:#00a8c8>local</span> <span style=color:#111>name</span> <span style=color:#f92672>=</span> <span style=color:#111>...</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>local</span> <span style=color:#111>parent</span><span style=color:#111>,</span> <span style=color:#111>root</span> <span style=color:#f92672>=</span> <span style=color:#111>parent_root</span><span style=color:#111>(</span><span style=color:#111>name</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>local</span> <span style=color:#111>util</span> <span style=color:#f92672>=</span> <span style=color:#111>require</span><span style=color:#111>(</span><span style=color:#d88200>&#34;editor.util&#34;</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>local</span> <span style=color:#111>json</span> <span style=color:#f92672>=</span> <span style=color:#111>require</span><span style=color:#111>(</span><span style=color:#d88200>&#34;json&#34;</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>--</span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- save command performs on one entry.</span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- If user switch to another entry without saving, the previous change will be lost.</span>
</span></span><span style=display:flex><span><span style=color:#75715e>--</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>local</span> <span style=color:#111>instance</span> <span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>  <span style=color:#111>require</span><span style=color:#111>(</span><span style=color:#d88200>&#34;commands.kwik.baseCommand&#34;</span><span style=color:#111>).</span><span style=color:#111>new</span><span style=color:#111>(</span>
</span></span><span style=display:flex><span>  <span style=color:#00a8c8>function</span><span style=color:#111>(</span><span style=color:#111>params</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>    <span style=color:#00a8c8>local</span> <span style=color:#111>UI</span> <span style=color:#f92672>=</span> <span style=color:#111>params.UI</span>
</span></span><span style=display:flex><span>    <span style=color:#00a8c8>local</span> <span style=color:#111>props</span> <span style=color:#f92672>=</span> <span style=color:#111>params.props</span>
</span></span><span style=display:flex><span>    <span style=color:#00a8c8>local</span> <span style=color:#111>tool</span> <span style=color:#f92672>=</span> <span style=color:#111>UI.editor</span><span style=color:#111>:</span><span style=color:#111>getTool</span><span style=color:#111>(</span><span style=color:#111>props.class</span><span style=color:#111>)</span> <span style=color:#75715e>-- each tool.contoller can overide render/save. So page tools of audio, group, timer should use own render/save</span>
</span></span><span style=display:flex><span>    <span style=color:#00a8c8>if</span> <span style=color:#111>tool</span> <span style=color:#00a8c8>then</span>
</span></span><span style=display:flex><span>      <span style=color:#00a8c8>local</span> <span style=color:#111>files</span> <span style=color:#f92672>=</span> <span style=color:#111>{}</span>
</span></span><span style=display:flex><span>      <span style=color:#00a8c8>local</span> <span style=color:#111>toolName</span> <span style=color:#f92672>=</span> <span style=color:#111>UI.editor</span><span style=color:#111>:</span><span style=color:#111>getToolName</span><span style=color:#111>(</span><span style=color:#111>props.class</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>      <span style=color:#00a8c8>local</span> <span style=color:#111>filename</span> <span style=color:#f92672>=</span> <span style=color:#111>props.name</span>
</span></span><span style=display:flex><span>      <span style=color:#00a8c8>local</span> <span style=color:#111>classname</span> <span style=color:#f92672>=</span> <span style=color:#111>props.class</span><span style=color:#111>:</span><span style=color:#111>lower</span><span style=color:#111>()</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>-------------</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>-- save lua</span>
</span></span><span style=display:flex><span>      <span style=color:#111>files</span><span style=color:#111>[</span><span style=color:#f92672>#</span><span style=color:#111>files</span><span style=color:#f92672>+</span><span style=color:#ae81ff>1</span><span style=color:#111>]</span> <span style=color:#f92672>=</span> <span style=color:#111>tool.controller</span><span style=color:#111>:</span><span style=color:#111>render</span><span style=color:#111>(</span><span style=color:#111>UI.editor</span><span style=color:#111>.</span><span style=color:#111>currentBook</span><span style=color:#111>,</span> <span style=color:#111>UI.page</span><span style=color:#111>,</span> <span style=color:#111>UI.editor</span><span style=color:#111>.</span><span style=color:#111>currentLayer</span><span style=color:#111>,</span> <span style=color:#111>toolName</span><span style=color:#111>,</span> <span style=color:#111>classname</span><span style=color:#111>,</span> <span style=color:#111>props</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>-----------</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>--- save json</span>
</span></span><span style=display:flex><span>      <span style=color:#00a8c8>local</span> <span style=color:#111>decoded</span> <span style=color:#f92672>=</span> <span style=color:#111>params.decoded</span> <span style=color:#f92672>or</span> <span style=color:#111>{}</span>
</span></span><span style=display:flex><span>      <span style=color:#111>decoded</span><span style=color:#111>[</span><span style=color:#111>props.index</span><span style=color:#111>]</span> <span style=color:#f92672>=</span> <span style=color:#111>props</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>--</span>
</span></span><span style=display:flex><span>      <span style=color:#111>files</span><span style=color:#111>[</span><span style=color:#f92672>#</span><span style=color:#111>files</span><span style=color:#f92672>+</span><span style=color:#ae81ff>1</span><span style=color:#111>]</span> <span style=color:#f92672>=</span> <span style=color:#111>tool.controller</span><span style=color:#111>:</span><span style=color:#111>save</span><span style=color:#111>(</span><span style=color:#111>UI.editor</span><span style=color:#111>.</span><span style=color:#111>currentBook</span><span style=color:#111>,</span> <span style=color:#111>UI.page</span><span style=color:#111>,</span> <span style=color:#111>UI.editor</span><span style=color:#111>.</span><span style=color:#111>currentLayer</span><span style=color:#111>,</span><span style=color:#111>toolName</span><span style=color:#111>,</span> <span style=color:#111>decoded</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>-----------</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>--- Update components/pageX/index.lua model/pageX/index.json</span>
</span></span><span style=display:flex><span>      <span style=color:#00a8c8>local</span> <span style=color:#111>updatedModel</span> <span style=color:#f92672>=</span> <span style=color:#111>util.createIndexModel</span><span style=color:#111>(</span><span style=color:#111>UI.scene</span><span style=color:#111>.</span><span style=color:#111>model</span><span style=color:#111>,</span> <span style=color:#111>UI.editor</span><span style=color:#111>.</span><span style=color:#111>currentLayer</span><span style=color:#111>,</span> <span style=color:#111>classname</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>      <span style=color:#111>files</span><span style=color:#111>[</span><span style=color:#f92672>#</span><span style=color:#111>files</span><span style=color:#f92672>+</span><span style=color:#ae81ff>1</span><span style=color:#111>]</span> <span style=color:#f92672>=</span> <span style=color:#111>tool.controller</span><span style=color:#111>:</span><span style=color:#111>renderIndex</span><span style=color:#111>(</span><span style=color:#111>UI.editor</span><span style=color:#111>.</span><span style=color:#111>currentBook</span><span style=color:#111>,</span> <span style=color:#111>UI.page</span><span style=color:#111>,</span> <span style=color:#111>updatedModel</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>      <span style=color:#111>files</span><span style=color:#111>[</span><span style=color:#f92672>#</span><span style=color:#111>files</span><span style=color:#f92672>+</span><span style=color:#ae81ff>1</span><span style=color:#111>]</span> <span style=color:#f92672>=</span> <span style=color:#111>tool.controller</span><span style=color:#111>:</span><span style=color:#111>saveIndex</span><span style=color:#111>(</span><span style=color:#111>UI.editor</span><span style=color:#111>.</span><span style=color:#111>currentBook</span><span style=color:#111>,</span> <span style=color:#111>UI.page</span><span style=color:#111>,</span> <span style=color:#111>UI.editor</span><span style=color:#111>.</span><span style=color:#111>currentLayer</span><span style=color:#111>,</span><span style=color:#111>classname</span><span style=color:#111>,</span> <span style=color:#111>updatedModel</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>----------</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>-- publish</span>
</span></span><span style=display:flex><span>      <span style=color:#111>util.executePubish</span><span style=color:#111>(</span><span style=color:#111>files</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>    <span style=color:#00a8c8>else</span>
</span></span><span style=display:flex><span>      <span style=color:#111>print</span><span style=color:#111>(</span><span style=color:#d88200>&#34;tool not found for&#34;</span><span style=color:#111>,</span> <span style=color:#111>props.class</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>    <span style=color:#00a8c8>end</span>
</span></span><span style=display:flex><span>  <span style=color:#00a8c8>end</span>
</span></span><span style=display:flex><span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>--</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>return</span> <span style=color:#111>instance</span>
</span></span></code></pre></div><div class=chevrons><div id=navigation><a class="nav nav-prev" href=/kwik5docs/bookstore/versions/ title="Book Versions"><i class="fa fa-chevron-left"></i><label>Book Versions</label></a>
<a class="nav nav-next" href=/kwik5docs/implementation/audio_editor/ title="Audio Editor" style=margin-right:0><label>Audio Editor</label><i class="fa fa-chevron-right"></i></a></div></div></section></article><footer><div class=footline><div class=date><i class='fa fa-calendar'></i> 08/05/2023</div><div class=github-link><a href=https://github.com/vjeantet/hugo-theme-docdock/edit/master/exampleSite/content/implementation/_index.md target=blank><i class="fa fa-code-fork"></i></a></div></div><div></div></footer><script src=/kwik5docs/js/jquery-2.x.min.js></script>
<script type=text/javascript>var baseurl="https://kwiksher.github.io/kwik5docs/"</script><script src=/kwik5docs/js/clipboard.min.js></script>
<script src=/kwik5docs/js/featherlight.min.js></script>
<script type=text/javascript src=/kwik5docs/js/lunr.min.js></script>
<script type=text/javascript src=/kwik5docs/js/auto-complete.js></script>
<script type=text/javascript src=/kwik5docs/js/search.js></script>
<script src=/kwik5docs/theme-flex/script.js></script>
<script src=https://kwiksher.github.io/kwik5docs/js/scripts.min.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/mermaid/8.12.0/mermaid.min.js crossorigin=anonymous></script>
<script>mermaid.init(void 0,".language-mermaid")</script></body></html>